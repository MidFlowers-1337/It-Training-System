# ============================================================================
# 生产环境配置
# 激活方式: --spring.profiles.active=prod,mysql 或 prod,tidb
# 说明: 生产环境特定配置，注重性能和安全
# 警告: 生产环境必须通过环境变量配置敏感信息，不要在此文件中硬编码
# ============================================================================

# 日志配置 - 生产环境精简日志
logging:
  level:
    root: WARN
    com.itts: INFO
    org.springframework.web: WARN
    org.springframework.security: WARN
    org.mybatis: WARN
    org.springframework.jdbc.core: WARN

# SpringDoc OpenAPI 配置 - 生产环境禁用 Swagger
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

# Spring Boot Actuator 配置 - 生产环境限制暴露端点
management:
  endpoints:
    web:
      exposure:
        # 仅暴露健康检查和指标端点
        include: health,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized

# 生产环境特定配置
spring:
  # 禁用开发工具
  devtools:
    restart:
      enabled: false
    livereload:
      enabled: false

  # 数据源配置 - 生产环境必须通过环境变量配置
  datasource:
    hikari:
      # 生产环境连接池配置
      minimum-idle: ${DB_POOL_MIN_IDLE:10}
      maximum-pool-size: ${DB_POOL_MAX_SIZE:50}
      # 连接泄漏检测
      leak-detection-threshold: 60000

# JWT 配置 - 生产环境
jwt:
  # 生产环境必须通过环境变量 JWT_SECRET 设置强密钥
  # 不要使用默认值！
  secret: ${JWT_SECRET}
  expiration: ${JWT_EXPIRATION:86400000}

# AI 推荐配置 - 生产环境
ai:
  recommend:
    enabled: ${AI_RECOMMEND_ENABLED:true}
    timeout: ${AI_RECOMMEND_TIMEOUT:5000}  # 生产环境超时时间更短
    fallback-on-error: true

# 服务器配置 - 生产环境
server:
  # 生产环境端口
  port: ${SERVER_PORT:8080}
  # 错误页面配置
  error:
    include-message: never
    include-binding-errors: never
    include-stacktrace: never
    include-exception: false
  # 压缩配置
  compression:
    enabled: true
    min-response-size: 1024

# 应用自定义配置 - 生产环境
app:
  # 跨域配置 - 生产环境必须明确指定允许的域名
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS}
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS
    allowed-headers: "*"
    allow-credentials: true
    max-age: 3600

# ============================================================================
# 生产环境安全检查清单
# ============================================================================
# 1. ✅ JWT_SECRET 必须通过环境变量设置，至少 32 个字符
# 2. ✅ DB_PASSWORD 必须通过环境变量设置
# 3. ✅ AI_API_KEY 必须通过环境变量设置（如果使用 AI 功能）
# 4. ✅ CORS_ALLOWED_ORIGINS 必须明确指定，不要使用 *
# 5. ✅ Swagger UI 已禁用
# 6. ✅ 日志级别已设置为 WARN/INFO
# 7. ✅ 错误信息不暴露堆栈跟踪
# 8. ✅ Actuator 端点已限制暴露
# ============================================================================
