# 模块01：基础工程与公共模块 - 实施步骤

## 一、准备工作

### 1.1 环境检查
- [ ] 确认JDK 17已安装
- [ ] 确认Maven已配置
- [ ] 确认IDE（IDEA/VSCode）已就绪
- [ ] 确认Git已配置

### 1.2 项目初始化
- [ ] 确认Spring Boot项目已创建（it-training-backend）
- [ ] 确认项目能正常启动
- [ ] 确认基础目录结构存在

---

## 二、Maven依赖配置

### 2.1 编辑pom.xml
- [ ] 添加Spring Boot核心依赖
  - spring-boot-starter-web
  - spring-boot-starter-security
  - spring-boot-starter-validation
  - spring-boot-starter-aop

- [ ] 添加数据库相关依赖
  - mybatis-spring-boot-starter (3.0.3)
  - mysql-connector-j (8.0.33)
  - pagehelper-spring-boot-starter (1.4.7)
  - flyway-core

- [ ] 添加缓存与消息队列依赖
  - spring-boot-starter-data-redis
  - redisson-spring-boot-starter (3.27.2)
  - rocketmq-spring-boot-starter (2.3.0)
  - caffeine (3.1.8)

- [ ] 添加AI相关依赖
  - spring-ai-ollama-spring-boot-starter (1.0.0-M1)

- [ ] 添加工具类库
  - hutool-all (5.8.25)
  - jjwt-api, jjwt-impl, jjwt-jackson (0.12.5)
  - easyexcel (3.3.4)
  - guava (32.1.3-jre)

- [ ] 添加文档工具
  - springdoc-openapi-starter-webmvc-ui (2.3.0)

- [ ] 添加测试依赖
  - spring-boot-starter-test

- [ ] 执行 `mvn clean install` 验证依赖下载

---

## 三、创建包结构

### 3.1 创建基础包
在 `src/main/java/com/ittraining/` 下创建：
- [ ] `common` - 公共模块
- [ ] `config` - 配置类
- [ ] `controller` - 控制器
- [ ] `service` - 服务层
- [ ] `mapper` - 数据访问层
- [ ] `entity` - 实体类
- [ ] `dto` - 数据传输对象
- [ ] `vo` - 视图对象

### 3.2 创建common子包
在 `common/` 下创建：
- [ ] `constant` - 常量定义
- [ ] `enums` - 枚举类
- [ ] `exception` - 异常处理
- [ ] `response` - 统一响应
- [ ] `utils` - 工具类

---

## 四、统一返回体

### 4.1 创建Result类
- [ ] 创建 `common/response/Result.java`
- [ ] 定义字段：code, message, data, timestamp
- [ ] 实现静态方法：
  - success()
  - success(T data)
  - error(String message)
  - error(int code, String message)

### 4.2 创建PageResult类
- [ ] 创建 `common/response/PageResult.java`
- [ ] 定义字段：total, pages, pageNum, pageSize, list
- [ ] 实现构造方法和getter/setter

---

## 五、统一异常处理

### 5.1 创建错误码枚举
- [ ] 创建 `common/exception/ErrorCode.java`
- [ ] 定义常用错误码：
  - SUCCESS(200, "操作成功")
  - PARAMS_ERROR(400, "参数错误")
  - NOT_LOGIN(401, "未登录")
  - NO_AUTH(403, "无权限")
  - NOT_FOUND(404, "资源不存在")
  - SYSTEM_ERROR(500, "系统错误")

### 5.2 创建业务异常类
- [ ] 创建 `common/exception/BusinessException.java`
- [ ] 继承RuntimeException
- [ ] 添加errorCode和message字段
- [ ] 实现构造方法

### 5.3 创建全局异常处理器
- [ ] 创建 `common/exception/GlobalExceptionHandler.java`
- [ ] 添加@RestControllerAdvice注解
- [ ] 实现异常处理方法：
  - handleBusinessException - 业务异常
  - handleValidationException - 参数校验异常
  - handleException - 兜底异常
- [ ] 所有方法返回Result格式

---

## 六、常量定义

### 6.1 创建Redis键常量
- [ ] 创建 `common/constant/RedisKeyConstant.java`
- [ ] 定义常量：
  - USER_TOKEN_PREFIX
  - COURSE_STOCK_PREFIX
  - ENROLL_LOCK_PREFIX
  - ENROLL_CHECK_PREFIX

### 6.2 创建角色常量
- [ ] 创建 `common/constant/RoleConstant.java`
- [ ] 定义角色：ROLE_ADMIN, ROLE_TEACHER, ROLE_STUDENT

### 6.3 创建状态常量
- [ ] 创建 `common/constant/StatusConstant.java`
- [ ] 定义状态：ENABLE, DISABLE, DELETED

---

## 七、枚举类

### 7.1 创建枚举类
- [ ] 创建 `common/enums/CourseStatusEnum.java`
- [ ] 创建 `common/enums/EnrollmentStatusEnum.java`
- [ ] 创建 `common/enums/PaymentStatusEnum.java`
- [ ] 创建 `common/enums/UserRoleEnum.java`
- [ ] 每个枚举包含：code, message, 构造方法, getter

---

## 八、工具类

### 8.1 创建JWT工具类
- [ ] 创建 `common/utils/JwtUtil.java`
- [ ] 实现方法：
  - generateToken(userId, username, role)
  - parseToken(token)
  - validateToken(token)
  - refreshToken(token)

### 8.2 创建密码工具类
- [ ] 创建 `common/utils/PasswordUtil.java`
- [ ] 实现方法：
  - encode(rawPassword) - BCrypt加密
  - matches(rawPassword, encodedPassword)

### 8.3 创建Redis工具类
- [ ] 创建 `common/utils/RedisUtil.java`
- [ ] 注入RedisTemplate
- [ ] 实现方法：
  - set/get/delete/expire
  - increment/decrement
  - setIfAbsent

### 8.4 创建文件工具类
- [ ] 创建 `common/utils/FileUtil.java`
- [ ] 实现方法：
  - upload(MultipartFile, path)
  - delete(filePath)
  - getFileExtension(filename)
  - validateFileType(filename, allowedTypes)

---

## 九、配置类

### 9.1 跨域配置
- [ ] 创建 `config/CorsConfig.java`
- [ ] 实现WebMvcConfigurer
- [ ] 配置CORS：
  - 允许的源（开发环境：localhost:5173）
  - 允许的方法（GET, POST, PUT, DELETE, OPTIONS）
  - 允许的头（Authorization, Content-Type）
  - 允许携带凭证

### 9.2 Swagger配置
- [ ] 创建 `config/SwaggerConfig.java`
- [ ] 配置OpenAPI 3.0
- [ ] 添加JWT认证配置
- [ ] 设置API信息（标题、版本、描述）

### 9.3 MVC配置
- [ ] 创建 `config/WebMvcConfig.java`
- [ ] 实现WebMvcConfigurer
- [ ] 配置静态资源映射
- [ ] 配置文件上传大小限制

### 9.4 MyBatis配置
- [ ] 创建 `config/MyBatisConfig.java`
- [ ] 配置PageHelper
- [ ] 配置驼峰命名转换
- [ ] 配置Mapper扫描路径

### 9.5 Redis配置
- [ ] 创建 `config/RedisConfig.java`
- [ ] 配置RedisTemplate
- [ ] 配置序列化方式（Jackson2JsonRedisSerializer）
- [ ] 配置连接池

### 9.6 Redisson配置
- [ ] 创建 `config/RedissonConfig.java`
- [ ] 配置Redisson客户端
- [ ] 配置单机/集群模式

---

## 十、日志配置

### 10.1 创建logback配置
- [ ] 创建 `src/main/resources/logback-spring.xml`
- [ ] 配置控制台输出（开发环境）
- [ ] 配置文件输出（生产环境）
- [ ] 配置按日期和大小滚动
- [ ] 配置不同级别日志分文件

---

## 十一、application.yaml配置

### 11.1 基础配置
- [ ] 配置server.port
- [ ] 配置spring.application.name
- [ ] 配置spring.profiles.active

### 11.2 数据源配置
- [ ] 配置spring.datasource（使用环境变量）
- [ ] 配置spring.jpa
- [ ] 配置spring.flyway

### 11.3 Redis配置
- [ ] 配置spring.redis.host
- [ ] 配置spring.redis.port
- [ ] 配置spring.redis.password
- [ ] 配置连接池参数

### 11.4 日志配置
- [ ] 配置logging.level
- [ ] 配置logging.file

---

## 十二、测试验证

### 12.1 创建健康检查接口
- [ ] 创建 `controller/HealthController.java`
- [ ] 实现GET /api/health接口
- [ ] 返回系统状态信息

### 12.2 启动测试
- [ ] 启动Spring Boot应用
- [ ] 访问 http://localhost:8080/api/health
- [ ] 验证返回正常

### 12.3 Swagger测试
- [ ] 访问 http://localhost:8080/swagger-ui.html
- [ ] 验证API文档正常显示

### 12.4 Redis连接测试
- [ ] 编写测试类测试RedisUtil
- [ ] 验证set/get操作正常

---

## 十三、代码规范

### 13.1 添加注释
- [ ] 为所有类添加类注释
- [ ] 为所有公共方法添加方法注释
- [ ] 为复杂逻辑添加行内注释

### 13.2 代码格式化
- [ ] 统一代码格式（IDEA格式化）
- [ ] 统一命名规范
- [ ] 移除无用导入

---

## 十四、Git提交

### 14.1 提交代码
- [ ] git add .
- [ ] git commit -m "feat: 完成基础工程与公共模块搭建"
- [ ] git push

---

## 验收标准

- ✅ 项目能正常启动
- ✅ 健康检查接口返回正常
- ✅ Swagger文档能正常访问
- ✅ Redis连接正常
- ✅ 统一返回体和异常处理生效
- ✅ 所有工具类单元测试通过
- ✅ 代码符合规范，注释完整

---

## 预计耗时

- **总计：3-5天**
  - 依赖配置和包结构：0.5天
  - 统一返回和异常处理：0.5天
  - 工具类开发：1天
  - 配置类开发：1天
  - 测试和文档：1天

---

## 下一步

完成本模块后，进入 **模块02：安全与认证模块**