# IT技能培训智能选课系统 - 后端模块详细实现清单（续）

## 模块7：技能评估模块

### 7.1 题库实体类
- [ ] `Question.java`
  - id, courseId, questionType, questionContent
  - questionOptions (JSON), correctAnswer, questionAnalysis
  - difficultyLevel, score, tagIds, useCount, status

### 7.2 考试实体类
- [ ] `Exam.java`
  - id, examName, courseId, examType, totalScore, passScore
  - duration, startTime, endTime, questionIds (JSON), status
  
- [ ] `ExamRecord.java`
  - id, examId, studentId, startTime, submitTime
  - score, isPass, answerData (JSON), status

- [ ] `Certificate.java`
  - id, certificateNo, studentId, courseId, certificateType
  - certificateName, certificateUrl, issueDate, expiryDate, status

### 7.3 题库Controller
- [ ] `QuestionController.java` (教师端)
  - GET /api/teacher/questions - 题库列表
  - POST /api/teacher/questions - 创建试题
  - PUT /api/teacher/questions/{id} - 更新试题
  - DELETE /api/teacher/questions/{id} - 删除试题
  - POST /api/teacher/questions/batch - 批量导入

### 7.4 考试Controller
- [ ] `ExamController.java` (学生端)
  - GET /api/exams/course/{courseId} - 课程考试列表
  - GET /api/exams/{id} - 考试详情
  - POST /api/exams/{id}/start - 开始考试
  - POST /api/exams/{id}/submit - 提交答卷
  - GET /api/exams/records/{recordId} - 考试记录详情
  - GET /api/exams/records/my - 我的考试记录

- [ ] `TeacherExamController.java` (教师端)
  - POST /api/teacher/exams - 创建考试
  - PUT /api/teacher/exams/{id} - 更新考试
  - DELETE /api/teacher/exams/{id} - 删除考试
  - POST /api/teacher/exams/{id}/generate - 生成试卷
  - GET /api/teacher/exams/{id}/records - 考试记录列表

### 7.5 题库Service
- [ ] `IQuestionService.java`
  - getQuestionList(查询条件)
  - createQuestion(创建请求)
  - updateQuestion(更新请求)
  - deleteQuestion(id)
  - batchImport(Excel文件)
  - getRandomQuestions(courseId, count, difficultyLevel)

### 7.6 考试Service
- [ ] `IExamService.java`
  - createExam(创建请求)
  - updateExam(更新请求)
  - deleteExam(id)
  - generatePaper(examId) - 生成试卷
  - startExam(examId, studentId) - 开始考试
  - submitExam(examId, studentId, answers) - 提交答卷
  - autoGrade(examRecordId) - 自动评分
  - getExamRecord(recordId)

### 7.7 证书Service
- [ ] `ICertificateService.java`
  - generateCertificate(studentId, courseId) - 生成证书
  - getCertificateList(studentId)
  - downloadCertificate(certificateId) - 下载证书
  - verifyCertificate(certificateNo) - 验证证书

### 7.8 实现要点
- [ ] 试卷生成算法（随机抽题、难度分布）
- [ ] 考试计时器（Redis存储考试状态）
- [ ] 自动评分逻辑（选择题、判断题、填空题）
- [ ] 证书生成（PDF模板 + 数据填充）
- [ ] 防作弊机制（题目乱序、选项乱序）

### 7.9 Mapper层
- [ ] `QuestionMapper.java` + XML
- [ ] `ExamMapper.java` + XML
- [ ] `ExamRecordMapper.java` + XML
- [ ] `CertificateMapper.java` + XML

---

## 模块8：AI智能推荐模块

### 8.1 AI实体类
- [ ] `StudentSkill.java` (学员技能)
  - id, studentId, skillName, skillLevel, skillScore
  - acquireTime, lastPracticeTime

- [ ] `LearningPath.java` (学习路径)
  - id, pathName, pathType, targetPosition
  - difficultyLevel, description, courseSequence (JSON)
  - estimatedDuration, status

- [ ] `AiRecommendation.java` (推荐记录)
  - id, studentId, courseId, recommendationType
  - recommendationScore, recommendationReason, isAccepted

- [ ] `AiConversation.java` (对话记录)
  - id, userId, sessionId, userMessage, aiResponse
  - messageType, contextData (JSON)

### 8.2 AI配置
- [ ] `OllamaConfig.java`
  - 配置Ollama服务地址
  - 配置模型名称(qwen3)
  - 配置超时时间
  - 配置重试策略

### 8.3 AI Controller
- [ ] `AiController.java`
  - POST /api/ai/chat - AI对话
  - GET /api/ai/recommend - 获取推荐课程
  - POST /api/ai/recommend/feedback - 推荐反馈
  - GET /api/ai/learning-path - 获取学习路径
  - GET /api/ai/conversations - 对话历史

### 8.4 AI Service
- [ ] `IAiChatService.java`
  - chat(userId, message, sessionId) - 对话
  - getConversationHistory(sessionId) - 获取历史
  - clearConversation(sessionId) - 清空会话

- [ ] `IAiRecommendService.java`
  - recommendCourses(studentId) - AI推荐课程
  - recommendByContent(studentId) - 基于内容推荐
  - recommendByCollaborative(studentId) - 协同过滤推荐
  - recommendLearningPath(studentId) - 学习路径推荐
  - saveFeedback(recommendationId, isAccepted) - 保存反馈

### 8.5 Prompt模板管理
- [ ] `PromptTemplate.java`
  - COURSE_RECOMMEND_PROMPT - 课程推荐模板
  - LEARNING_PATH_PROMPT - 学习路径模板
  - SKILL_ASSESSMENT_PROMPT - 技能评估模板
  - buildPrompt(template, params) - 构建Prompt

### 8.6 推荐策略
- [ ] `ContentBasedStrategy.java` (基于内容)
  - 根据课程标签和学员技能匹配
  - 计算相似度得分

- [ ] `CollaborativeStrategy.java` (协同过滤)
  - 找相似学员
  - 推荐相似学员选过的课程

- [ ] `PathBasedStrategy.java` (路径推荐)
  - 根据职业目标规划课程序列
  - 考虑前置课程依赖

### 8.7 实现要点
- [ ] Spring AI集成与配置
- [ ] Ollama本地模型调用
- [ ] 对话上下文管理（Redis存储）
- [ ] 推荐算法实现
- [ ] 推荐结果缓存
- [ ] 推荐效果评估

### 8.8 Mapper层
- [ ] `StudentSkillMapper.java` + XML
- [ ] `LearningPathMapper.java` + XML
- [ ] `AiRecommendationMapper.java` + XML
- [ ] `AiConversationMapper.java` + XML

---

## 模块9：论坛社区模块

### 9.1 论坛实体类
- [ ] `ForumPost.java` (帖子)
  - id, courseId, userId, title, content, postType
  - viewCount, replyCount, likeCount
  - isTop, isEssence, status

- [ ] `ForumReply.java` (回复)
  - id, postId, userId, parentId, replyContent
  - likeCount, status

### 9.2 论坛DTO
- [ ] `PostCreateRequest.java`
  - courseId, title, content, postType

- [ ] `PostQueryRequest.java`
  - courseId, postType, keyword
  - sortBy (最新、最热、精华)
  - pageNum, pageSize

- [ ] `ReplyCreateRequest.java`
  - postId, parentId, replyContent

### 9.3 论坛Controller
- [ ] `ForumController.java`
  - GET /api/forum/posts - 帖子列表
  - GET /api/forum/posts/{id} - 帖子详情
  - POST /api/forum/posts - 发布帖子
  - PUT /api/forum/posts/{id} - 编辑帖子
  - DELETE /api/forum/posts/{id} - 删除帖子
  - POST /api/forum/posts/{id}/like - 点赞帖子
  - GET /api/forum/posts/{id}/replies - 回复列表
  - POST /api/forum/replies - 发布回复
  - DELETE /api/forum/replies/{id} - 删除回复
  - POST /api/forum/replies/{id}/like - 点赞回复

### 9.4 论坛Service
- [ ] `IForumService.java`
  - getPostList(查询条件)
  - getPostDetail(postId)
  - createPost(创建请求)
  - updatePost(更新请求)
  - deletePost(postId)
  - likePost(postId, userId)
  - getReplyList(postId, pageNum, pageSize)
  - createReply(创建请求)
  - deleteReply(replyId)
  - likeReply(replyId, userId)
  - setTop(postId, isTop) - 置顶
  - setEssence(postId, isEssence) - 设为精华

### 9.5 实现要点
- [ ] Markdown内容渲染
- [ ] 点赞防刷（Redis记录用户点赞）
- [ ] 浏览量统计（Redis计数器）
- [ ] 敏感词过滤（基础版）
- [ ] 内容审核机制
- [ ] 热门帖子排序算法

### 9.6 Mapper层
- [ ] `ForumPostMapper.java` + XML
  - 动态查询（按课程、类型、关键词）
  - 增加浏览量、回复数、点赞数
  
- [ ] `ForumReplyMapper.java` + XML
  - 查询帖子的回复（支持分页）
  - 查询回复的子回复（楼中楼）

---

## 模块10：支付管理模块（可选）

### 10.1 订单实体类
- [ ] `OrderInfo.java`
  - id, orderNo, userId, courseId
  - orderAmount, discountAmount, actualAmount
  - paymentMethod, paymentStatus, tradeNo
  - paymentTime, refundTime, orderStatus, remark

### 10.2 支付DTO
- [ ] `OrderCreateRequest.java`
  - courseId, paymentMethod

- [ ] `PaymentCallbackRequest.java`
  - 支付宝回调参数

### 10.3 支付Controller
- [ ] `PaymentController.java`
  - POST /api/payment/orders - 创建订单
  - GET /api/payment/orders/{orderNo} - 查询订单
  - POST /api/payment/alipay - 支付宝支付
  - POST /api/payment/alipay/callback - 支付宝回调
  - POST /api/payment/orders/{orderNo}/refund - 申请退款
  - GET /api/payment/orders/my - 我的订单列表

### 10.4 支付Service
- [ ] `IPaymentService.java`
  - createOrder(userId, courseId) - 创建订单
  - getOrderByNo(orderNo) - 查询订单
  - alipayPay(orderNo) - 支付宝支付
  - handleAlipayCallback(params) - 处理回调
  - refundOrder(orderNo) - 退款
  - getMyOrders(userId, pageNum, pageSize)

### 10.5 实现要点
- [ ] 支付宝沙箱环境配置
- [ ] 订单号生成（唯一性）
- [ ] 支付回调验签
- [ ] 幂等性处理（防止重复回调）
- [ ] 订单状态机
- [ ] 超时未支付订单处理
- [ ] 退款流程

### 10.6 Mapper层
- [ ] `OrderMapper.java` + XML
  - 创建订单
  - 更新支付状态
  - 查询订单（按订单号、用户ID）

---

## 模块11：数据统计模块

### 11.1 统计VO
- [ ] `DashboardVO.java` (控制台数据)
  - 用户总数、课程总数、选课总数
  - 今日新增用户、今日选课数
  - 热门课程Top10
  - 最近7天趋势数据

- [ ] `CourseStatisticsVO.java` (课程统计)
  - 课程选课人数、完成人数、完成率
  - 平均学习时长、平均评分
  - 学员分布（按难度、按地区）

- [ ] `StudentStatisticsVO.java` (学员统计)
  - 学习课程数、完成课程数
  - 总学习时长、获得证书数
  - 技能树进度、学习日历

### 11.2 统计Controller
- [ ] `StatisticsController.java` (管理员端)
  - GET /api/admin/statistics/dashboard - 控制台数据
  - GET /api/admin/statistics/users - 用户统计
  - GET /api/admin/statistics/courses - 课程统计
  - GET /api/admin/statistics/enrollments - 选课统计
  - GET /api/admin/statistics/revenue - 收入统计
  - POST /api/admin/statistics/export - 导出报表

- [ ] `TeacherStatisticsController.java` (教师端)
  - GET /api/teacher/statistics/courses - 我的课程统计
  - GET /api/teacher/statistics/students - 学员统计

- [ ] `StudentStatisticsController.java` (学生端)
  - GET /api/student/statistics/overview - 学习概览
  - GET /api/student/statistics/progress - 学习进度
  - GET /api/student/statistics/calendar - 学习日历

### 11.3 统计Service
- [ ] `IStatisticsService.java`
  - getDashboardData() - 控制台数据
  - getUserStatistics(startDate, endDate) - 用户统计
  - getCourseStatistics(courseId) - 课程统计
  - getEnrollmentStatistics(startDate, endDate) - 选课统计
  - getStudentStatistics(studentId) - 学员统计
  - exportReport(type, params) - 导出报表

### 11.4 实现要点
- [ ] 复杂SQL聚合查询
- [ ] 统计数据缓存（Redis）
- [ ] 定时任务更新统计数据
- [ ] EasyExcel导出Excel
- [ ] 图表数据格式化
- [ ] 大数据量分页查询优化

### 11.5 Mapper层
- [ ] `StatisticsMapper.java` + XML
  - 各种统计查询SQL
  - 使用GROUP BY、COUNT、SUM、AVG等聚合函数
  - 时间范围查询
  - 多表关联统计

---

## 模块12：系统管理模块

### 12.1 系统实体类
- [ ] `SystemNotice.java` (系统公告)
  - id, noticeTitle, noticeContent, noticeType
  - priority, targetRole, isTop
  - publishTime, expireTime, status

- [ ] `OperationLog.java` (操作日志)
  - id, userId, username, operationType, operationDesc
  - requestMethod, requestUrl, requestParams, responseResult
  - ipAddress, userAgent, executeTime, status, errorMessage

### 12.2 系统DTO
- [ ] `NoticeCreateRequest.java`
- [ ] `NoticeUpdateRequest.java`
- [ ] `LogQueryRequest.java`
  - userId, operationType, status
  - startTime, endTime
  - pageNum, pageSize

### 12.3 系统Controller
- [ ] `SystemController.java` (管理员端)
  - GET /api/admin/notices - 公告列表
  - POST /api/admin/notices - 创建公告
  - PUT /api/admin/notices/{id} - 更新公告
  - DELETE /api/admin/notices/{id} - 删除公告
  - PUT /api/admin/notices/{id}/publish - 发布公告
  - GET /api/admin/logs - 操作日志列表
  - GET /api/admin/config - 系统配置
  - PUT /api/admin/config - 更新配置

- [ ] `NoticeController.java` (公共)
  - GET /api/notices - 公告列表（学生端）
  - GET /api/notices/{id} - 公告详情

### 12.4 系统Service
- [ ] `ISystemNoticeService.java`
  - getNoticeList(查询条件)
  - createNotice(创建请求)
  - updateNotice(更新请求)
  - deleteNotice(id)
  - publishNotice(id)
  - getActiveNotices(targetRole) - 获取有效公告

- [ ] `IOperationLogService.java`
  - saveLog(日志对象) - 保存日志
  - getLogList(查询条件) - 日志列表
  - deleteLog(id) - 删除日志
  - clearLogs(beforeDate) - 清理日志

- [ ] `ISystemConfigService.java`
  - getConfig(key) - 获取配置
  - updateConfig(key, value) - 更新配置
  - getAllConfigs() - 所有配置

### 12.5 日志切面
- [ ] `LogAspect.java`
  - @Around注解拦截Controller方法
  - 记录请求参数、响应结果
  - 记录执行时间
  - 记录异常信息
  - 异步保存日志到数据库

### 12.6 实现要点
- [ ] 公告定时发布
- [ ] 公告过期自动下架
- [ ] 操作日志异步记录
- [ ] 日志定期清理（定时任务）
- [ ] 系统配置热更新
- [ ] 敏感信息脱敏

### 12.7 Mapper层
- [ ] `SystemNoticeMapper.java` + XML
- [ ] `OperationLogMapper.java` + XML
- [ ] `SystemConfigMapper.java` + XML

---

## 模块13：集成与测试

### 13.1 单元测试
- [ ] Service层单元测试
  - 使用Mockito模拟依赖
  - 测试业务逻辑正确性
  - 测试异常处理
  - 测试边界条件

- [ ] Mapper层测试
  - 使用@MybatisTest
  - 测试SQL正确性
  - 测试复杂查询

### 13.2 接口测试
- [ ] Controller层集成测试
  - 使用MockMvc
  - 测试HTTP请求响应
  - 测试参数校验
  - 测试权限控制

### 13.3 高并发测试
- [ ] 选课接口压力测试
  - 使用JMeter或Gatling
  - 模拟1000+并发用户
  - 测试库存一致性
  - 测试防重机制
  - 测试限流效果

### 13.4 性能优化
- [ ] SQL优化
  - 添加必要索引
  - 优化慢查询
  - 避免N+1查询
  - 使用批量操作

- [ ] 缓存优化
  - 热点数据缓存
  - 缓存预热
  - 缓存穿透/击穿/雪崩防护
  - 缓存更新策略

- [ ] 代码优化
  - 异步处理
  - 批量操作
  - 连接池优化
  - 线程池优化

### 13.5 CI/CD（可选）
- [ ] GitHub Actions配置
  - 自动构建
  - 自动测试
  - 代码质量检查
  - 自动部署

### 13.6 文档完善
- [ ] API文档（Swagger）
- [ ] 数据库设计文档
- [ ] 部署文档
- [ ] 用户手册
- [ ] 开发规范文档

---

## 实施建议

### 开发顺序
1. **第1周**: 模块1 + 模块2（基础 + 认证）
2. **第2周**: 模块3（用户管理）
3. **第3-4周**: 模块4（课程管理）
4. **第5-6周**: 模块5（选课管理 - 核心）
5. **第7周**: 模块6（学习管理）
6. **第8周**: 模块7（技能评估）
7. **第9-10周**: 模块8（AI推荐）
8. **第11周**: 模块9（论坛社区）
9. **第12周**: 模块11（数据统计）
10. **第13周**: 模块12（系统管理）
11. **第14周**: 模块10（支付 - 可选）
12. **第15-16周**: 模块13（测试优化）

### 每个模块的开发流程
1. **数据库设计** - 创建表结构和索引
2. **实体类** - 创建Entity、DTO、VO
3. **Mapper层** - 编写Mapper接口和XML
4. **Service层** - 编写Service接口和实现
5. **Controller层** - 编写Controller和接口
6. **单元测试** - 编写测试用例
7. **接口测试** - 使用Postman/Apifox测试
8. **文档更新** - 更新Swagger文档

### 注意事项
- 每完成一个模块立即测试
- 及时提交代码到Git
- 保持代码规范和注释
- 定期Code Review
- 关注性能和安全
- 做好异常处理和日志记录